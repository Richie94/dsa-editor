@if (hero) {
    <div>
        <mat-card class="my-top-card">
            <mat-card-header>
                <mat-card-title class="my-card-title">
                    Eigenschaften
                </mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <mat-form-field class="property-form-field">
                    <mat-label>MU</mat-label>
                    <input readonly="{{readOnly()}}" matInput id="hero-mu" [(ngModel)]="hero.hero_stats.mu"
                           placeholder="mu" type="number">
                </mat-form-field>

                <mat-form-field class="property-form-field">
                    <mat-label>KL</mat-label>
                    <input readonly="{{readOnly()}}" matInput id="hero-kl" [(ngModel)]="hero.hero_stats.kl"
                           placeholder="kl" type="number">
                </mat-form-field>

                <mat-form-field class="property-form-field">
                    <mat-label>IN</mat-label>
                    <input readonly="{{readOnly()}}" matInput id="hero-in" [(ngModel)]="hero.hero_stats.in"
                           placeholder="in" type="number">
                </mat-form-field>

                <mat-form-field class="property-form-field">
                    <mat-label>CH</mat-label>
                    <input readonly="{{readOnly()}}" matInput id="hero-ch" [(ngModel)]="hero.hero_stats.ch"
                           placeholder="ch" type="number">
                </mat-form-field>

                <mat-form-field class="property-form-field">
                    <mat-label>FF</mat-label>
                    <input readonly="{{readOnly()}}" matInput id="hero-ff" [(ngModel)]="hero.hero_stats.ff"
                           placeholder="ff" type="number">
                </mat-form-field>

                <mat-form-field class="property-form-field">
                    <mat-label>GE</mat-label>
                    <input readonly="{{readOnly()}}" matInput id="hero-ge" [(ngModel)]="hero.hero_stats.ge"
                           placeholder="ge" type="number">
                </mat-form-field>

                <mat-form-field class="property-form-field">
                    <mat-label>KO</mat-label>
                    <input readonly="{{readOnly()}}" matInput id="hero-ko" [(ngModel)]="hero.hero_stats.ko"
                           placeholder="ko" type="number">
                </mat-form-field>

                <mat-form-field class="property-form-field">
                    <mat-label>KK</mat-label>
                    <input readonly="{{readOnly()}}" matInput id="hero-kk" [(ngModel)]="hero.hero_stats.kk"
                           placeholder="kk" type="number">
                </mat-form-field>
            </mat-card-content>
        </mat-card>

        <mat-card class="my-card">
            <mat-card-header>
                <mat-card-title style="color: white">Sonderfertigkeiten</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div style="width: 100%">
                    <mat-list fxFlex fxLayout="column" fxLayoutGap="16px">
                        @for (ability of hero.special_abilities; track trackByIndex(i, ability); let i = $index) {
                            <mat-list-item
                            >
                                <div fxFlex fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="5px">
                                    <mat-form-field class="mat-ability">
                                        <input readonly="{{readOnly()}}" matInput
                                               [(ngModel)]="hero.special_abilities[i]"
                                               placeholder="Fähigkeit" type="text">
                                    </mat-form-field>
                                    <button mat-raised-button color="primary" class="remove-action-button">
                                        <a href="https://ulisses-regelwiki.de/suche.html?keywords={{hero.special_abilities[i]}}" target="_blank" rel="noopener noreferrer">
                                            <mat-icon style="color: white">help</mat-icon>
                                        </a>
                                    </button>
                                    <button mat-raised-button color="primary" (click)="removeSpecialAbility(i)"
                                            class="remove-action-button">
                                        <mat-icon style="color: white">delete</mat-icon>
                                    </button>
                                </div>
                            </mat-list-item>
                        }
                        <mat-list-item>
                            <button mat-raised-button color="primary" class="add-action-button"
                                    (click)="newSpecialAbility()">+
                            </button>
                        </mat-list-item>
                    </mat-list>
                </div>
            </mat-card-content>
        </mat-card>
        <mat-card class="my-card">
            <mat-card-header>
                <mat-card-title class="my-card-title">
                    Talente
                </mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <mat-tab-group animationDuration="0ms">
                    <mat-tab label="Körper">
                        <table mat-table [dataSource]="getBodyTalents()" [multiTemplateDataRows]="true" class="mat-elevation-z8">
                            <!-- Talent Column -->
                            <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef>Talent</th>
                                <td mat-cell *matCellDef="let element"> {{ element.name }}</td>
                            </ng-container>
                            <!-- Probe Column (Tooltip shows QS probabilities) -->
                            <ng-container matColumnDef="probe">
                                <th mat-header-cell *matHeaderCellDef>Probe</th>
                                <td mat-cell *matCellDef="let element">
                                    <div class="probe-form-field"
                                         [matTooltip]="resolveProbe(element.probe) + ' — ' + qsSummary(element)"
                                         [matTooltipHideDelay]="isTouch ? 8000 : null"
                                         [matTooltipDisabled]="isTouch"
                                         (click)="toggleExpanded('body', getBodyTalents().indexOf(element))">
                                        <span>{{ element.probe.split("/").join(" ") }}</span>
                                        <mat-icon class="chevron" [ngClass]="{expanded: isExpanded('body', getBodyTalents().indexOf(element))}">expand_more</mat-icon>
                                    </div>
                                </td>
                            </ng-container>
                            <!-- Skill Column -->
                            <ng-container matColumnDef="fw">
                                <th mat-header-cell *matHeaderCellDef>FW</th>
                                <td mat-cell *matCellDef="let element">
                                    <input class="fw-input" [readOnly]="readOnly()" [(ngModel)]="element.value"
                                           type="number" inputmode="numeric"/>
                                </td>
                            </ng-container>
                            <!-- Expanded detail column/row -->
                            <ng-container matColumnDef="expandedDetail">
                                <td mat-cell *matCellDef="let element" [attr.colspan]="attributeColumns.length">
                                    <div class="probe-detail">
                                        <div><strong>Probe:</strong> {{ resolveProbe(element.probe) }} <strong>QS:</strong> {{ qsSummary(element) }}</div>
                                    </div>
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="attributeColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: attributeColumns;" class="table-row"></tr>
                            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']; when: isBodyDetailRow" class="detail-row"></tr>
                        </table>
                    </mat-tab>
                    <mat-tab label="Gesellschaft">
                        <table mat-table [dataSource]="getSocialTalents()" [multiTemplateDataRows]="true" class="mat-elevation-z8">
                            <!-- Talent Column -->
                            <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef>Talent</th>
                                <td mat-cell *matCellDef="let element"> {{ element.name }}</td>
                            </ng-container>
                            <!-- Probe Column (Tooltip shows QS probabilities) -->
                            <ng-container matColumnDef="probe">
                                <th mat-header-cell *matHeaderCellDef>Probe</th>
                                <td mat-cell *matCellDef="let element">
                                    <div class="probe-form-field"
                                         [matTooltip]="resolveProbe(element.probe) + ' — ' + qsSummary(element)"
                                         [matTooltipHideDelay]="isTouch ? 8000 : null"
                                         [matTooltipDisabled]="isTouch"
                                         (click)="toggleExpanded('social', getSocialTalents().indexOf(element))">
                                        <span>{{ element.probe.split("/").join(" ") }}</span>
                                        <mat-icon class="chevron" [ngClass]="{expanded: isExpanded('social', getSocialTalents().indexOf(element))}">expand_more</mat-icon>
                                    </div>
                                </td>
                            </ng-container>
                            <!-- Skill Column -->
                            <ng-container matColumnDef="fw">
                                <th mat-header-cell *matHeaderCellDef>FW</th>
                                <td mat-cell *matCellDef="let element">
                                    <input class="fw-input" [readOnly]="readOnly()" [(ngModel)]="element.value"
                                           type="number" inputmode="numeric"/>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="expandedDetail">
                                <td mat-cell *matCellDef="let element" [attr.colspan]="attributeColumns.length">
                                    <div class="probe-detail">
                                        <div><strong>Probe:</strong> {{ resolveProbe(element.probe) }} <strong>QS:</strong> {{ qsSummary(element) }}</div>
                                    </div>
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="attributeColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: attributeColumns;" class="table-row"></tr>
                            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']; when: isSocialDetailRow" class="detail-row"></tr>
                        </table>
                    </mat-tab>
                    <mat-tab label="Natur">
                        <table mat-table [dataSource]="getNatureTalents()" [multiTemplateDataRows]="true" class="mat-elevation-z8">
                            <!-- Talent Column -->
                            <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef>Talent</th>
                                <td mat-cell *matCellDef="let element"> {{ element.name }}</td>
                            </ng-container>
                            <!-- Probe Column (Tooltip shows QS probabilities) -->
                            <ng-container matColumnDef="probe">
                                <th mat-header-cell *matHeaderCellDef>Probe</th>
                                <td mat-cell *matCellDef="let element">
                                    <div class="probe-form-field"
                                         [matTooltip]="resolveProbe(element.probe) + ' — ' + qsSummary(element)"
                                         [matTooltipHideDelay]="isTouch ? 8000 : null"
                                         [matTooltipDisabled]="isTouch"
                                         (click)="toggleExpanded('nature', getNatureTalents().indexOf(element))">
                                        <span>{{ element.probe.split("/").join(" ") }}</span>
                                        <mat-icon class="chevron" [ngClass]="{expanded: isExpanded('nature', getNatureTalents().indexOf(element))}">expand_more</mat-icon>
                                    </div>
                                </td>
                            </ng-container>
                            <!-- Skill Column -->
                            <ng-container matColumnDef="fw">
                                <th mat-header-cell *matHeaderCellDef>FW</th>
                                <td mat-cell *matCellDef="let element">
                                    <input class="fw-input" [readOnly]="readOnly()" [(ngModel)]="element.value"
                                           type="number" inputmode="numeric"/>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="expandedDetail">
                                <td mat-cell *matCellDef="let element" [attr.colspan]="attributeColumns.length">
                                    <div class="probe-detail">
                                        <div><strong>Probe:</strong> {{ resolveProbe(element.probe) }} <strong>QS:</strong> {{ qsSummary(element) }}</div>
                                    </div>
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="attributeColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: attributeColumns;" class="table-row"></tr>
                            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']; when: isNatureDetailRow" class="detail-row"></tr>
                        </table>
                    </mat-tab>
                    <mat-tab label="Wissen">
                        <table mat-table [dataSource]="getKnowledgeTalents()" [multiTemplateDataRows]="true" class="mat-elevation-z8">
                            <!-- Talent Column -->
                            <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef>Talent</th>
                                <td mat-cell *matCellDef="let element"> {{ element.name }}</td>
                            </ng-container>
                            <!-- Probe Column (Tooltip shows QS probabilities) -->
                            <ng-container matColumnDef="probe">
                                <th mat-header-cell *matHeaderCellDef>Probe</th>
                                <td mat-cell *matCellDef="let element">
                                    <div class="probe-form-field"
                                         [matTooltip]="resolveProbe(element.probe) + ' — ' + qsSummary(element)"
                                         [matTooltipHideDelay]="isTouch ? 8000 : null"
                                         [matTooltipDisabled]="isTouch"
                                         (click)="toggleExpanded('knowledge', getKnowledgeTalents().indexOf(element))">
                                        <span>{{ element.probe.split("/").join(" ") }}</span>
                                        <mat-icon class="chevron" [ngClass]="{expanded: isExpanded('knowledge', getKnowledgeTalents().indexOf(element))}">expand_more</mat-icon>
                                    </div>
                                </td>
                            </ng-container>
                            <!-- Skill Column -->
                            <ng-container matColumnDef="fw">
                                <th mat-header-cell *matHeaderCellDef>FW</th>
                                <td mat-cell *matCellDef="let element">
                                    <input class="fw-input" [readOnly]="readOnly()" [(ngModel)]="element.value"
                                           type="number" inputmode="numeric"/>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="expandedDetail">
                                <td mat-cell *matCellDef="let element" [attr.colspan]="attributeColumns.length">
                                    <div class="probe-detail">
                                        <div><strong>Probe:</strong> {{ resolveProbe(element.probe) }} <strong>QS:</strong> {{ qsSummary(element) }}</div>
                                    </div>
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="attributeColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: attributeColumns;" class="table-row"></tr>
                            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']; when: isKnowledgeDetailRow" class="detail-row"></tr>
                        </table>
                    </mat-tab>
                    <mat-tab label="Handwerk">
                        <table mat-table [dataSource]="getCraftTalents()" [multiTemplateDataRows]="true" class="mat-elevation-z8">
                            <!-- Talent Column -->
                            <ng-container matColumnDef="name">
                                <th mat-header-cell *matHeaderCellDef>Talent</th>
                                <td mat-cell *matCellDef="let element"> {{ element.name }}</td>
                            </ng-container>
                            <!-- Probe Column (Tooltip shows QS probabilities) -->
                            <ng-container matColumnDef="probe">
                                <th mat-header-cell *matHeaderCellDef>Probe</th>
                                <td mat-cell *matCellDef="let element">
                                    <div class="probe-form-field"
                                         [matTooltip]="resolveProbe(element.probe) + ' — ' + qsSummary(element)"
                                         [matTooltipHideDelay]="isTouch ? 8000 : null"
                                         [matTooltipDisabled]="isTouch"
                                         (click)="toggleExpanded('craft', getCraftTalents().indexOf(element))">
                                        <span>{{ element.probe.split("/").join(" ") }}</span>
                                        <mat-icon class="chevron" [ngClass]="{expanded: isExpanded('craft', getCraftTalents().indexOf(element))}">expand_more</mat-icon>
                                    </div>
                                </td>
                            </ng-container>
                            <!-- Skill Column -->
                            <ng-container matColumnDef="fw">
                                <th mat-header-cell *matHeaderCellDef>FW</th>
                                <td mat-cell *matCellDef="let element">
                                    <input class="fw-input" [readOnly]="readOnly()" [(ngModel)]="element.value"
                                           type="number" inputmode="numeric"/>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="expandedDetail">
                                <td mat-cell *matCellDef="let element" [attr.colspan]="attributeColumns.length">
                                    <div class="probe-detail">
                                        <div><strong>Probe:</strong> {{ resolveProbe(element.probe) }} <strong>QS:</strong> {{ qsSummary(element) }}</div>
                                    </div>
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="attributeColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: attributeColumns;" class="table-row"></tr>
                            <tr mat-row *matRowDef="let row; columns: ['expandedDetail']; when: isCraftDetailRow" class="detail-row"></tr>
                        </table>
                    </mat-tab>
                </mat-tab-group>
            </mat-card-content>
        </mat-card>
    </div>
}
